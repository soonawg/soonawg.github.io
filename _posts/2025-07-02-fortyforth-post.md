---
title: "DeiT, Swin - ViT: ì—¬ë¦„ë°©í•™ ê³µë¶€ê¸°"
layout: post
date: 2025-07-02 15:25:00 +0900
categories: study
---

# DeiTì™€ Swin
ViTëŠ” ì¥ì ë„ ìˆì§€ë§Œ, ì—¬ì „íˆ ë§ì€ ë‹¨ì ì´ ì¡´ì¬í–ˆê³ , ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ìƒê²¨ë‚œ ëª¨ë¸ì¸ DeiTì™€ Swinì´ ìˆë‹¤.

# DeiT ê°œìš”
- ViTëŠ” ëŒ€ëŸ‰ì˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì„±ëŠ¥ì´ í¬ê²Œ ë–¨ì–´ì§€ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤.
- DeiTëŠ” Vitì˜ ë°ì´í„° íš¨ìœ¨ì„±ì„ í¬ê²Œ ê°œì„ í•œ ëª¨ë¸ì´ë‹¤.
- ì†ŒëŸ‰ì˜ ë¼ë²¨ ë°ì´í„°ë§Œ ìˆì–´ë„ ì¢‹ì€ ì„±ëŠ¥ì„ ë‚¼ ìˆ˜ ìˆë„ë¡ í•™ìŠµë²•ê³¼ ë°ì´í„° ì¦ê°•, ì§€ì‹ ì¦ë¥˜(knowledge distillation) ë°©ë²•ì„ ìƒˆë¡­ê²Œ ë„ì…í•˜ì˜€ë‹¤.

# DeiTì˜ ì£¼ìš” íŠ¹ì§• ë° ê¸°ë²•
## ë°ì´í„° íš¨ìœ¨ì  í•™ìŠµ
* ViTëŠ” ìˆ˜ë°±ë§Œ ì¥ ì´ìƒì˜ ë°ì´í„°(ì˜ˆ: ImageNet-21k) ì—†ì´ëŠ” ì˜ í•™ìŠµì´ ì•ˆ ë˜ëŠ”ë°, DeiTëŠ” ImageNet-1k(ì•½ 120ë§Œ ì¥) ì •ë„ì˜ ë°ì´í„°ë¡œë„ ì¢‹ì€ ì„±ëŠ¥ì„ ë‹¬ì„±í–ˆë‹¤.
* ë°ì´í„° íš¨ìœ¨ì„±ì„ ìœ„í•´ ë‹¤ì–‘í•œ ë°ì´í„° ì¦ê°• ë° ì •ê·œí™” ê¸°ë²•ì´ í™œìš©ëœë‹¤.

## ì§€ì‹ ì¦ë¥˜ (Knowledge Distillation)
- Teacher-student í”„ë ˆì„ì›Œí¬ë¥¼ í™œìš©í•œë‹¤.
- CNN ê¸°ë°˜ ê°•ë ¥í•œ ResNet ëª¨ë¸ì„ teacherë¡œ ì‚¬ìš©í•˜ì—¬, DeiT(student)ê°€ teacherì˜ ì¶œë ¥ì„ ëª¨ë°©í•˜ë„ë¡ í•™ìŠµí•œë‹¤.
- ì´ ê³¼ì •ì—ì„œ student ëª¨ë¸ì´ ë” ì ì€ ë°ì´í„°ë¡œë„ íš¨ê³¼ì ìœ¼ë¡œ í•™ìŠµí•œë‹¤.
- ì¦‰, teacherê°€ ë§Œë“  'soft label'ì´ studentë¥¼ ë³´ì¡°í•´ ì¤€ë‹¤.

## í† í° ë° êµ¬ì¡°ëŠ” ViTì™€ ìœ ì‚¬
- ì…ë ¥ ì´ë¯¸ì§€ë¥¼ íŒ¨ì¹˜ ë‹¨ìœ„ë¡œ ë¶„í• í•˜ê³ , ê° íŒ¨ì¹˜ë¥¼ Transformer ì…ë ¥ í† í°ìœ¼ë¡œ ë³€í™˜í•œë‹¤.
- ê¸°ì¡´ ViTì™€ ë™ì¼í•˜ê²Œ Transformer Encoder ë¸”ë¡ì„ ìŒ“ì•„ ì²˜ë¦¬í•œë‹¤.
- ìœ„ì¹˜ ì¸ì½”ë”©ë„ ë˜‘ê°™ì´ ì ìš©ëœë‹¤.

# DeiT í•™ìŠµ ë°©ë²•ê³¼ ì†ì‹¤ í•¨ìˆ˜
- ì¼ë°˜ì ì¸ ë¶„ë¥˜ ì†ì‹¤(í¬ë¡œìŠ¤ ì—”íŠ¸ë¡œí”¼) ì™¸ì—, ì§€ì‹ ì¦ë¥˜ ì†ì‹¤(distillation loss)ì´ ì¶”ê°€ëœë‹¤.
- ì´ ì†ì‹¤ í•¨ìˆ˜ëŠ” ë‹¤ìŒ ë‘ ê°€ì§€ë¥¼ ë”í•œ ê²ƒ:
    1. ê¸°ë³¸ ë¶„ë¥˜ ì†ì‹¤: í•™ìƒ ëª¨ë¸ì˜ ì¶œë ¥ê³¼ ì‹¤ì œ ë¼ë²¨ ê°„ í¬ë¡œìŠ¤ ì—”íŠ¸ë¡œí”¼
    2. ì¦ë¥˜ ì†ì‹¤: í•™ìƒ ëª¨ë¸ì˜ ì¶œë ¥ê³¼ êµì‚¬(ResNet) ëª¨ë¸ì˜ ì¶œë ¥ ê°„ ì°¨ì´
- ì´ ë‘ ì†ì‹¤ì„ ì ì ˆíˆ ê°€ì¤‘í•©í•˜ì—¬ ìµœì í•©í•œë‹¤.

# DeiTì˜ ì•„í‚¤í…ì²˜ ë° êµ¬ì¡°
- ì…ë ¥: 224Ã—224 RGB ì´ë¯¸ì§€ â†’ 16Ã—16 íŒ¨ì¹˜ë¡œ ë‚˜ëˆ” (ì´ 196ê°œ í† í°)
- íŒ¨ì¹˜ ì„ë² ë”©: ê° íŒ¨ì¹˜ë¥¼ ê³ ì°¨ì› ì„ë² ë”© ë²¡í„°ë¡œ ë³€í™˜
- Transformer Encoder: 12ê°œì˜ Transformer ë¸”ë¡(ê¸°ë³¸ DeiT-Base ëª¨ë¸ ê¸°ì¤€)
- Classification Token: í•™ìŠµ ê°€ëŠ¥í•œ íŠ¹ìˆ˜ í† í° [CLS]ë¥¼ ì…ë ¥ ë§¨ ì•ì— ì¶”ê°€í•˜ì—¬ ìµœì¢… ë¶„ë¥˜ìš© ì •ë³´ë¡œ í™œìš©
- ìµœì¢… ì¶œë ¥: [CLS] í† í°ì˜ ìµœì¢… ìƒíƒœë¥¼ ë¶„ë¥˜ê¸°(MLP)ì— ì „ë‹¬í•´ í´ë˜ìŠ¤ í™•ë¥  

# DeiTì˜ ì„±ëŠ¥ ë° ì¥ì 
- ë™ì¼í•œ ë°ì´í„°(ì˜ˆ: ImageNet-1k)ì—ì„œ ViT ëŒ€ë¹„ ë†’ì€ ì •í™•ë„ ë‹¬ì„±
- ImageNet-1kë§Œìœ¼ë¡œë„ ImageNet-21k ì‚¬ì „í•™ìŠµí•œ ViTì™€ ë¹„ìŠ·í•œ ìˆ˜ì¤€ ì„±ëŠ¥
- CNN ê¸°ë°˜ ëª¨ë¸ê³¼ ê²½ìŸ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ ì„±ëŠ¥
- ë°ì´í„°ê°€ ì œí•œì ì¼ ë•Œë„ ì˜ ì‘ë™
- ì¶”ê°€ì ì¸ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ ì—†ì´ë„ í•™ìŠµ íš¨ìœ¨ ê°œì„ 

# ë‹¤ìŒì€ ìƒ˜í”Œ ì½”ë“œì´ë‹¤.
**[Code](https://github.com/soonawg/vit_sample/blob/main/deit_sample.py)**

--------------------------

# Swin ê°œìš”
- Swin TransformerëŠ” Vitì˜ í•œê³„(ê³„ì‚°ëŸ‰, ë¡œì»¬ ì •ë³´ í•™ìŠµ ë¶€ì¡±)ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ ê³ ì•ˆëœ ëª¨ë¸ì´ë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ ViT ê¸°ë°˜ì´ì§€ë§Œ, CNNì²˜ëŸ¼ ë¡œì»¬-íˆ¬-ê¸€ë¡œë²Œ í‘œí˜„ì„ í•™ìŠµí•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤.
- í•µì‹¬ ì•„ì´ë””ì–´ëŠ” ìœˆë„ìš° ê¸°ë°˜ì˜ self-attention + ìœˆë„ìš°ë¥¼ shiftí•´ì„œ ì •ë³´ê°€ êµë¥˜ë˜ë„ë¡ í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.

# Swinì˜ êµ¬ì¡°
## ğŸŸ¦ **ìœˆë„ìš° ê¸°ë°˜ self-attention**
- ViTì²˜ëŸ¼ ì „ì²´ íŒ¨ì¹˜ì— global self-attentionì„ ì ìš©í•˜ë©´ ê³„ì‚°ëŸ‰ì´ ë§¤ìš° ì»¤ì§„ë‹¤.
- Swinì—ì„œëŠ” ê³ ì •ëœ ìœˆë„ìš°(ì˜ˆ: 7x7 í¬ê¸°)ì˜ íŒ¨ì¹˜ ì•ˆì—ì„œë§Œ self-attentionì„ ìˆ˜í–‰í•œë‹¤.
    - â†’ ì´ë ‡ê²Œ í•˜ë©´ local self-attentionìœ¼ë¡œ ë©”ëª¨ë¦¬ì™€ ê³„ì‚°ëŸ‰ì„ ì¤„ì¸ë‹¤.
- ëŒ€ì‹  **ìœˆë„ìš°ë¥¼ ë§¤ë²ˆ ì•½ê°„ì”© ì´ë™(shift)** ì‹œì¼œ ë‹¤ìŒ ê³„ì¸µì—ì„œ ë‹¤ë¥¸ ìœˆë„ìš°ë¼ë¦¬ ì •ë³´ë¥¼ êµí™˜í•˜ê²Œ í•œë‹¤.
    - â†’ shift windowingìœ¼ë¡œ ìœˆë„ìš° ê°„ ì •ë³´ íë¦„ì„ ë³´ì¥í•œë‹¤.

## ğŸŸ¦ **ê³„ì¸µì  êµ¬ì¡° (hierarchical)**
- CNNì²˜ëŸ¼ resolutionì„ ì ì°¨ ì¤„ì´ëŠ” ë‹¨ê³„ì  êµ¬ì¡°
    - ì˜ˆ: Stage 1 â†’ Stage 2 â†’ Stage 3 â†’ Stage 4
- ì´ˆê¸°ì—ëŠ” ì‘ì€ íŒ¨ì¹˜(4x4) ë‹¨ìœ„ë¡œ ì…ë ¥ì„ ë‚˜ëˆ„ê³ , stageê°€ ì§„í–‰ë˜ë©´ì„œ patch mergingìœ¼ë¡œ í•´ìƒë„ë¥¼ ì¤„ì—¬ ë‚˜ê°€ë©° feature dimensionì„ í‚¤ìš´ë‹¤.
    - â†’ ì´ë¡œ ì¸í•´ ê³„ì¸µì  íŠ¹ì§• ì¶”ì¶œ(Hierarchical feature extraction)ì´ ê°€ëŠ¥í•˜ë‹¤.

## ğŸŸ¦ **Patch Merging**
- Swinì—ì„œëŠ” poolingì²˜ëŸ¼ ì‘ë™í•˜ëŠ” patch merging ì—°ì‚°ì„ ì‚¬ìš©í•´ feature mapì˜ í•´ìƒë„ë¥¼ ì ˆë°˜ìœ¼ë¡œ ì¤„ì¸ë‹¤.
- ì´ë•Œ ë‹¨ìˆœ pooling ëŒ€ì‹  patchë“¤ì„ concatenate í›„ ì„ í˜•ë³€í™˜ì„ ê±°ì³ í‘œí˜„ë ¥ì„ ìœ ì§€í•œë‹¤.

# Swinì˜ ì¥ì 
- ìœˆë„ìš° ê¸°ë°˜ attentionìœ¼ë¡œ ê³„ì‚°ëŸ‰ íš¨ìœ¨
- shift windowë¡œ ì¸ì ‘ ìœˆë„ìš° ê°„ ì •ë³´ êµë¥˜
- ê³„ì¸µì  êµ¬ì¡° -> CNNê³¼ ìœ ì‚¬í•œ multiscale feature ì¶”ì¶œ ê°€ëŠ¥
- ë‹¤ì–‘í•œ downstream task (ë¶„ë¥˜, ê²€ì¶œ, ë¶„í•  ë“±)ì— ìœ ì—°í•˜ê²Œ ì ìš© ê°€ëŠ¥

# ë‹¤ìŒì€ ìƒ˜í”Œ ì½”ë“œì´ë‹¤.
**[Code](https://github.com/soonawg/vit_sample/blob/main/swin_sample.py)**